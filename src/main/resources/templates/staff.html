<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="${#request.getContextPath()}+'/'">
    <title>后台管理系统</title>
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!--表格css-->
    <link rel="stylesheet" href="css/tables/datatables.min.css">
    <link rel="stylesheet" href="css/tables/datatables-http.min.css">
    <link rel="stylesheet" href="css/tables/jsgrid/jsgrid.css">
    <link rel="stylesheet" href="css/tables/jsgrid/theme.css">
    <link rel="stylesheet" href="css/tables/buttons.dataTables.min.css">
    <link rel="stylesheet" href="css/tables/jsgrid/demos.css">
    <link rel="stylesheet" href="css/tables/jsgrid/jsgridui.css">

    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="js/bootstrap-multitabs/multitabs.min.css">
    <link type="text/css" rel="stylesheet" href="js/jquery-tagsinput/jquery.tagsinput.min.css">
    <link type="text/css" rel="stylesheet" href="js/webuploader/webuploader.css">
    <link type="text/css" rel="stylesheet" href="js/magnific-popup/magnific-popup.min.css">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.min.css">
    <link rel="stylesheet" type="text/css" href="css/page.css">
    <!--引入下拉插件css-->
    <link rel="stylesheet" type="text/css" href="js/bootstrap-select/bootstrap-select.min.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="card-search mb-2-5">
                        <form class="search-form" method="post" role="form" action="toHt/staff">
                            <input type="hidden" id="pages" name="pages" th:value="${pageobj.currentPage}"/>
                            <input type="hidden" id="counts" name="counts" th:value="${pageobj.pageCount}"/>
                            <input type="hidden" id="lx" name="lx" th:value="${pageobj.othersql1}"/>
                            <!--text input-->
                            <div class="row g-4">
                                <div class="col-auto">
                                    <div class="row">
                                        <label class="col-auto col-form-label"
                                               style="padding-right:0;padding-left:10px;">名称</label>
                                        <div class="col-auto">
                                            <input type="text" class="form-control" id="name" name="name" th:value="${pageobj.othersql}"
                                                   placeholder="请输入名称"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="row">
                                        <label class="col-auto col-form-label" style="padding-right:0;padding-left:10px;">联系手机</label>
                                        <div class="col-auto">
                                            <input type="text" class="form-control" id="phone" name="phone" th:value="${pageobj.othersql6}"
                                                   placeholder="请输入联系手机"/>
                                        </div>
                                    </div>
                                </div>
                                <th:block th:if="${pageobj.othersql1=='B'}">
                                    <div class="col-auto" th:style="${session.umsg.jstype=='B'?'display: none':''}">
                                        <div class="row">
                                            <label class="col-auto col-form-label" style="padding-right:0;padding-left:10px;">授课方名称</label>
                                            <div class="col-auto">
                                                <select id="skid" name="skid"  class="form-control selectpicker" data-live-search="true">
                                                    <option value="" selected>请选择</option>
                                                    <th:block th:each="item,stat:${smdlist}">
                                                        <option th:value="${item.smd001}"  th:selected="${pageobj.othersql5==#strings.toString(item.smd001)?true:false}">[[${item.smd003}]]</option>
                                                    </th:block>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                                <th:block th:if="${pageobj.othersql1=='C'}">
                                    <div class="col-auto" th:style="${session.umsg.jstype=='C'?'display: none':''}">
                                        <div class="row">
                                            <label class="col-auto col-form-label" style="padding-right:0;padding-left:10px;">授课方名称</label>
                                            <div class="col-auto">
                                                <select id="skid" name="skid"  class="form-control selectpicker" data-live-search="true">
                                                    <option value="" selected>请选择</option>
                                                    <th:block th:each="item,stat:${yhblist}">
                                                        <option th:value="${item.yhb001}"  th:selected="${pageobj.othersql5==#strings.toString(item.yhb001)?true:false}">[[${item.yhb004}]]</option>
                                                    </th:block>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                                <!--button-->
                                <div class="col-auto">
                                    <button type="submit" class="btn btn-primary me-1">搜索</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div id="wrapp" >
                        <div class="jsgrid table-responsive" data-parent="#accordion">
                            <input type="file" id="file" name="file" style="display: none" onchange="daoru(this)"/>
                            <table class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;" id="staffexm" >
                                <thead>
                                <tr>
                                    <th style="max-width:30px;">序号</th>
                                    <th>微信头像</th>
                                    <th>微信昵称</th>
                                    <th>账户名称</th>
                                    <th>真实姓名</th>
                                    <th>联系手机</th>
                                    <th>状态</th>
                                    <th style="max-width:80px;">操作</th>
                                </tr>
                                </thead>
                                <tbody id="tablebody">
                                    <tr th:each="item,stat:${pageobj.resultList}">
                                    <td th:text="${stat.index+1}"></td>
                                        <th:block th:if="${pageobj.othersql1!='A'}">
                                            <th th:text="${pageobj.othersql1=='B'?item.smd.smd003:item.yhb.yhb004}"></th>
                                        </th:block>
                                        <td><img class="wimg" th:src="${item.use008!=null?'upload/tximg/'+item.use008:'images/nopic.png'}" style='width:100px;height:auto;object-fit:cover;border:1px solid rgb(229, 229, 229);'></td>
                                        <td th:text="${item.use007}"></td>
                                        <td th:text="${item.use002}"></td>
                                        <td th:text="${item.use004}"></td>
                                        <td th:text="${item.use005}"></td>
                                        <td th:text="${item.use013=='M'?'正常':(item.use013=='N'?'封号':(item.use013=='P'?'审核':(item.use013=='E'?'驳回':'')))}"></td>
                                        <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="javascript:void(0);" th:onclick="edit([[${item.toString()}]])" class="btn btn-table"
                                               data-bs-toggle="modal" data-bs-target="#editmode">编辑</a>
                                            <div class="ivu-divider-vertical"></div>
                                            <a class="btn btn-table" data-bs-toggle="modal" data-bs-target="#delmode" th:onclick="czmm([[${item.use001}]])">重置密码</a>
                                            <div class="ivu-divider-vertical"><!----></div>
                                            <th:block th:if="${item.use013=='M'}">
                                                <a class="btn btn-table" data-bs-toggle="modal" data-bs-target="#delmode"  th:onclick="xgzt([[${item.use001}]],[[${item.use004}]],[['N']])">封号</a>
                                            </th:block>
                                            <th:block th:if="${item.use013=='N'}">
                                                <a class="btn btn-table" data-bs-toggle="modal" data-bs-target="#delmode" th:onclick="xgzt([[${item.use001}]],[[${item.use004}]],[['M']])">正常</a>
                                            </th:block>
                                            <th:block th:if="${item.use013=='P'}">
                                                <a class="btn btn-table" data-bs-toggle="modal" data-bs-target="#xqmode" th:onclick="tosh([[${item.toString()}]],[[${pageobj.othersql1=='B'?item.smd.toString():item.yhb.toString()}]],[[${pageobj.othersql1=='B'?'':item.yhb.yha.yha002}]])">审核通过</a>
                                            </th:block>
                                            <!--  <a href="javascript:void(0);" th:onclick="del([[${item.use001}]])" class="btn btn-table">删除</a>-->
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <ul class="pagination">
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- 详情模态框 -->
    <div class="modal fade" id="xqmode" tabindex="-1" aria-labelledby="exampleModalFullscreenLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="xqmodeLabel">查看详情</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div>
                    <div class="modal-body" style="min-height:580px;">

                    </div>
                    <div class="modal-footer" style="height:100px;">
                        <button type="button" class="btn btn-primary" id="shtg">通过</button>
                        <button type="button" class="btn btn-primary" id="shbh">驳回</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- 编辑分类模态框 -->
    <div class="modal fade" id="editmode" tabindex="-1" aria-labelledby="exampleModalFullscreenLabel"
         aria-hidden="true" style="height:100%;background-color: #FFF;">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="editmodeLabel"><span id="ftype"></span></h6>
                    <button type="button" onclick="pagerefalsh()" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="uploadForm" enctype="multipart/form-data">
                    <input type="hidden" id="fid" value=""/>
                    <div class="modal-body" style="min-height:580px;">
                        <div class="row col-auto" style="margin-top: 20px;">
                            <label class="col-auto col-form-label" style="padding-right:20px;padding-left:20px;">账户名称</label>
                            <div class="col-10 col-sm-8 col-md-6 col-lg-4">
                                <input type="text" class="form-control" id="t2" name="t2" placeholder="请输入账户名称"/>
                            </div>
                        </div>
                        <div class="row col-auto" style="margin-top: 20px;">
                            <label class="col-auto col-form-label" style="padding-right:20px;padding-left:20px;">真实姓名</label>
                            <div class="col-10 col-sm-8 col-md-6 col-lg-4">
                                <input type="text" class="form-control" id="t4" name="t4" placeholder="请输入真实姓名"/>
                            </div>
                        </div>
                        <div class="row col-auto" style="margin-top: 20px;">
                            <label class="col-auto col-form-label" style="padding-right:20px;padding-left:20px;">联系手机</label>
                            <div class="col-10 col-sm-8 col-md-6 col-lg-4">
                                <input type="text" class="form-control" id="t5" name="t5" placeholder="请输入联系手机"/>
                            </div>
                        </div>
                        <th:block th:if="${pageobj.othersql1=='B'}">
                        <div class="row col-auto" th:style="${session.umsg.jstype=='B'?'margin-top: 20px;display: none':'margin-top: 20px;'}">
                                <label class="col-auto col-form-label" style="padding-right:1px;padding-left:10px;">授课方</label>
                                <div class="form-controls">
                                    <select id="t11" name="t11"  class="form-control selectpicker" data-live-search="true">
                                        <option value="" selected>请选择</option>
                                        <th:block th:each="item,stat:${smdlist}">
                                            <option th:value="${item.smd001}" th:selected="${session.umsg.jstype=='B'&&pageobj.othersql5==#strings.toString(item.smd001)?true:false}">[[${item.smd003}]]</option>
                                        </th:block>
                                    </select>
                                </div>
                        </div>
                        </th:block>
                        <th:block th:if="${pageobj.othersql1=='C'}">
                        <div class="row col-auto" th:style="${session.umsg.jstype=='C'?'margin-top: 20px;display: none':'margin-top: 20px;'}">
                            <label class="col-auto col-form-label" style="padding-right:1px;padding-left:10px;">选课方</label>
                            <div class="form-controls">
                                <select id="t11" name="t11"  class="form-control selectpicker" data-live-search="true">
                                    <option value="" selected>请选择</option>
                                    <th:block th:each="item,stat:${yhblist}">
                                        <option th:value="${item.yhb001}"  th:selected="${session.umsg.jstype=='C'&&pageobj.othersql5==#strings.toString(item.yhb001)?true:false}">[[${item.yhb004}]]</option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                        </th:block>
                    </div>
                    <div class="modal-footer" style="height:100px;">
                        <button type="submit" class="btn btn-primary" id="edit-four">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>

<script type="text/javascript" src="js/main.min.js"></script>
<script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
<!--tags插件-->
<script type="text/javascript" src="js/jquery-tagsinput/jquery.tagsinput.min.js"></script>
<!--上传插件-->
<script type="text/javascript" src="js/webuploader/webuploader.js"></script>
<!--灯箱效果插件-->
<script type="text/javascript" src="js/magnific-popup/magnific-popup.min.js"></script>
<!--通知消息插件-->
<script type="text/javascript" src="js/bootstrap-notify.min.js"></script>
<!--引入标签插件js-->
<script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
<!--引入下拉插件js-->
<script type="text/javascript" src="js/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="js/bootstrap-select/i18n/defaults-zh_CN.min.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="js/layui/layui.js"></script>
<!-- 表格JS -->
<script type="text/javascript" src="static/tables/datatables.min.js"></script>
<script type="text/javascript" src="static/tables/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="static/tables/jszip.min.js"></script>
<script type="text/javascript" src="static/tables/pdfmake.min.js"></script>
<script type="text/javascript" src="static/tables/vfs_fonts.js"></script>
<script type="text/javascript" src="static/tables/buttons.html5.min.js"></script>
<script type="text/javascript" src="static/tables/buttons.print.min.js"></script>
<script type="text/javascript" src="static/tables/datatable.js"></script>
<!-- 翻页-->
<script type="text/javascript" src="pagejs/htfy.js"></script>
<!-- validate JS 验证-->
<script type="text/javascript" src="assets/jquery-validate/jquery.validate.js"></script>
<script type="text/javascript" src="assets/jquery-validate/validate-methods.js"></script>

<script type="text/javascript">

    var file_lastName="";
    var filesize;
    var layer = layui.layer;
    var load_index;

    function gobackpage(){
        window.history.back();
    }

    pdyes($("#pages").val(), $("#counts").val());

    //翻页
    function usefanye(pageindex){
        var params = [
            ["pages",pageindex],
            ["name", $("#name").val()],["phone", $("#phone").val()],["skid", $("#skid").val()]];
        form_submit("toHt/staff","post",params,"_self");
    }
    function xzmb(){
        var params = [  ["type","E"],
            ["pages",$("#pages").val()],
            ["name", $("#name").val()],["phone", $("#phone").val()],["skid", $("#skid").val()]];
        form_submit("toHt/staff","post",params,"_self");
    }


    function toxq(obj,obj1,cjname){
        let item = null;
        if(obj.indexOf("Hash")>0){
            item = striongTOjsonString(obj);
        }else{
            item = jsStringTojsonString(obj);
        }
        let item1 = null;
        if(obj1.indexOf("Hash")>0){
            item1 = striongTOjsonString(obj1);
        }else{
            item1 = jsStringTojsonString(obj1);
        }
        $("#xqmode").find(".modal-body").empty();
        let html="";
        if($("#lx").val()=="B"){
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">身份类别：</label>';
            html+= '<span class="jspan">'+(item1.smd002=='A'?'机构':(item1.smd002=='B'?'个人':(item1.smd002=='C'?'专家':'')))+'</span>';
            html+= '</div></div></div>';
            html+= '';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">机构名称/个人单位：</label>';
            html+= '<span class="jspan">'+item1.smd003+'</span>';
            html+= '</div></div></div>';
            html+= '';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">营业执照/身份证号：</label>';
            html+= '<span class="jspan">'+item1.smd004+'</span>';
            html+= '</div></div></div>';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">开户行：</label>';
            html+= '<span class="jspan">'+item1.smd005+'</span>';
            html+= '</div></div></div>';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">户名/银行卡号：</label>';
            html+= '<span class="jspan">'+item1.smd006+'</span>';
            html+= '</div></div></div>';
            html+= '';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">账号/姓名：</label>';
            html+= '<span class="jspan">'+item1.smd007+'</span>';
            html+= '</div></div></div>';
        }else{
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">层级：</label>';
            html+= '<span class="jspan">'+cjname+'</span>';
            html+= '</div></div></div>';
            html+= '';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">单位名称：</label>';
            html+= '<span class="jspan">'+item1.yhb004+'</span>';
            html+= '</div></div></div>';
            html+= '';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">单位地址：</label>';
            html+= '<span class="jspan">'+item1.yhb005+'</span>';
            html+= '</div></div></div>';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">联系人：</label>';
            html+= '<span class="jspan">'+item1.yhb006+'</span>';
            html+= '</div></div></div>';
            html+= '<div class="row"><div class="col-md-5">';
            html+= '<div class="form-group"><label class="layui-form-label">联系电话：</label>';
            html+= '<span class="jspan">'+item1.yhb007+'</span>';
            html+= '</div></div></div>';
            html+= '';
        }
        $("#shtg").attr("onclick","xgzt("+item.use001+","+item.use002+",'M')")
        $("#shbh").attr("onclick","xgzt("+item.use001+","+item.use002+",'E')")
        $("#xqmode").find(".modal-body").append(html);
    }

    function xgzt(id,uname,type){
        if(type=="E"){
            var num = prompt("请输入驳回备注","");
            if (num!="") {
                load_index = layer.load(1);
                var formData = new FormData();
                formData.append("fid",id);
                formData.append("uname",uname);
                formData.append("type",type);
                formData.append("t1",num);
                $.ajax({
                    url: 'toHt/xgztstaff', // 服务器端处理上传文件的URL
                    type: 'POST',
                    data: formData,
                    dataType:'json',
                    contentType: false, // 不设置内容类型
                    processData: false, // 不处理发送的数据
                    success: function (res) {
                        var d = eval(res);
                        if(d.msg=="0"){
                            layer.msg("修改成功");
                            setTimeout(function(){
                                location.reload();
                            },1000);
                            layer.close(load_index);
                        }
                    },
                    error: function () { console.log('提交失败'); }
                });
            }else{
                xgzt(id,uname,type);
            }
        }else if (confirm("您确定修改吗?")) {
            load_index = layer.load(1);
            var formData = new FormData();
            formData.append("fid",id);
            formData.append("uname",uname);
            formData.append("type",type);
            $.ajax({
                url: 'toHt/xgztstaff', // 服务器端处理上传文件的URL
                type: 'POST',
                data: formData,
                dataType:'json',
                contentType: false, // 不设置内容类型
                processData: false, // 不处理发送的数据
                success: function (res) {
                    var d = eval(res);
                    if(d.msg=="0"){
                        layer.msg("修改成功");
                        setTimeout(function(){
                            location.reload();
                        },1000);
                        layer.close(load_index);
                    }
                },
                error: function () { console.log('提交失败'); }
            });
        }
    }

    function drstaff(){
        $('#file').click();
    }

    function daoru(file){
        var fileTypes = [ ".xlsx",".xls" ];
        var filePath = file.value;
        // 当括号里面的值为0、空字符、false 、null 、undefined的时候就相当于false
        if (filePath) {
            var isNext = false;
            var fileEnd = filePath.substring(filePath.indexOf("."));
            for (var i = 0; i < fileTypes.length; i++) {
                if (fileTypes[i] == fileEnd) {
                    isNext = true;
                    break;
                }
            }
            if(isNext == true){
                daoruwj();
                return;
            }else{
                layer.alert('只允许上传以.xlsx和.xls结尾的文件');
                file.value = "";
                return;
            }
        } else {
            layer.alert('请选择文件');
        }
    }

    function daoruwj() {
        var formData = new FormData();
        formData.append("file", document.getElementById("file").files[0]);
        var index = layer.load(1, {
            content: "导入中",
            shade: [0.1, 'black'], //0.1透明度的白色背景
            success: function (layero) {
                layero.find('.layui-layer-content').css({
                    'padding-top': '39px',
                    'width': '60px'
                });
            }
        });
        $.ajax({
            url: 'toHt/drstaff',
            type: 'POST',
            data: formData,
            //async: false,                      //async 设置为 false，则所有的请求均为同步请求，在没有返回值之前，同步请求将锁住浏览器
            cache: false,                      // 不缓存
            processData: false,                // jQuery不要去处理发送的数据
            contentType: false,                // jQuery不要去设置Content-Type请求头
            dataType: 'text',
            success: function (data) {
                if (data == 'A') {
                    var params = [
                        ["pages", $("#pages").val()],
                        ["name", $("#name").val()],["phone", $("#phone").val()],["skid", $("#skid").val()]];
                    // layer.msg("导入成功", {time: 1000}, function () {
                    form_submit("toHt/staff", "post", params, "_self");
                    // });
                } else if (data == 'B') {
                    // layer.msg("导入失败");
                    $("#file1").val("");
                } else {
                    deleteCookie('tab_list');
                    deleteCookie('left_menu_father');
                    deleteCookie('left_menu_son');
                    var error = "登录失效";
                    window.parent.location = 'login?error=' + error;
                }
            },
            error: function () { layer.close(index); }
        });
    }

    function del(id){
        if (confirm("您确定删除吗?")) {
            load_index = layer.load(1);
            var formData = new FormData();
            formData.append("fid",id);
            $.ajax({
                url: 'toHt/delstaff', // 服务器端处理上传文件的URL
                type: 'POST',
                data: formData,
                dataType:'json',
                contentType: false, // 不设置内容类型
                processData: false, // 不处理发送的数据
                success: function (res) {
                    var d = eval(res);
                    layer.msg("删除成功");
                    setTimeout(function(){
                        location.reload();
                    },1000);
                    layer.close(load_index);
                },
                error: function () { console.log('提交失败'); }
            });
        }
    }

    function czmm(id){
        if (confirm("您确定重置密码吗?")) {
            load_index = layer.load(1);
            var formData = new FormData();
            formData.append("fid",id);
            $.ajax({
                url: 'toHt/resstaff', // 服务器端处理上传文件的URL
                type: 'POST',
                data: formData,
                dataType:'json',
                contentType: false, // 不设置内容类型
                processData: false, // 不处理发送的数据
                success: function (res) {
                    var d = eval(res);
                    layer.msg("重置成功");
                    setTimeout(function(){
                        location.reload();
                    },1000);
                    layer.close(load_index);
                },
                error: function () { console.log('提交失败'); }
            });
        }
    }


    //刷新页面
    function pagerefalsh(){
        location.reload();
    }

    function edit(obj){
        if(obj!=null&&obj!=''){
            let josnobj = null;
            if(obj.indexOf("Hash")>0){
                josnobj = striongTOjsonString(obj);
            }else{
                josnobj = jsStringTojsonString(obj);
            }
            $("#fid").val(josnobj.use001);
            $("#t2").val(josnobj.use002);
            $("#t4").val(josnobj.use004);
            $("#t5").val(josnobj.use005);
            if(josnobj.use011!=null)$("#t11").val(josnobj.use011);
            $("#ftype").text("编辑");
        }else{
            $("#ftype").text("添加");
        }
    }
    $("#uploadForm").validate({
        errorPlacement: function(error, element) {
            //替换错误显示位置，error表示错误信息
            $(element).parent("div").parent("div").append(error);
            $(element).parent("div").parent("div").find("label").addClass("col-12");
            // $(element).parent("div").parent("div").find("label").attr("style","margin-left:5px;");
        },
        rules : {t2: { required : true, },t4: { required : true, },t5: { required : true, },},
        messages: {},
        submitHandler: function(form) {
            load_index = layer.load(1);
            var formData = new FormData();
            formData.append("fid",$("#fid").val().trim());
            formData.append("t2",$("#t2").val());
            formData.append("t4",$("#t4").val());
            formData.append("t5",$("#t5").val());
            formData.append("t11",$("#t11").val());
            formData.append("t9",$("#lx").val());
            $.ajax({
                url: 'toHt/xgstaff', // 服务器端处理上传文件的URL
                type: 'POST',
                data: formData,
                dataType:'json',
                contentType: false, // 不设置内容类型
                processData: false, // 不处理发送的数据
                success: function (res) {
                    var d = eval(res);
                    $("#fid").val(d.use001);
                    layer.close(load_index);
                    layer.msg("提交成功");
                },
                error: function () { console.log('提交失败'); }
            });

        }
    });
</script>
</body>
</html>