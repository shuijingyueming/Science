<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="${#request.getContextPath()}+'/'">
    <title>后台管理系统</title>
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!--表格css-->
    <link rel="stylesheet" href="css/tables/datatables.min.css">
    <link rel="stylesheet" href="css/tables/datatables-http.min.css">
    <link rel="stylesheet" href="css/tables/jsgrid/jsgrid.css">
    <link rel="stylesheet" href="css/tables/jsgrid/theme.css">
    <link rel="stylesheet" href="css/tables/buttons.dataTables.min.css">
    <link rel="stylesheet" href="css/tables/jsgrid/demos.css">
    <link rel="stylesheet" href="css/tables/jsgrid/jsgridui.css">

    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="js/bootstrap-multitabs/multitabs.min.css">
    <link type="text/css" rel="stylesheet" href="js/jquery-tagsinput/jquery.tagsinput.min.css">
    <link type="text/css" rel="stylesheet" href="js/webuploader/webuploader.css">
    <link type="text/css" rel="stylesheet" href="js/magnific-popup/magnific-popup.min.css">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.min.css">
    <link rel="stylesheet" type="text/css" href="css/page.css">
    <!--引入下拉插件css-->
    <link rel="stylesheet" type="text/css" href="js/bootstrap-select/bootstrap-select.min.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="card-search mb-2-5">
                        <form class="search-form" method="post" role="form" action="toHt/log">
                            <input type="hidden" id="pages" name="pages" th:value="${pageobj.currentPage}"/>
                            <input type="hidden" id="counts" name="counts" th:value="${pageobj.pageCount}"/>
                            <!--text input-->
                            <div class="row g-4">
                                <div class="col-auto">
                                    <div class="row">
                                        <label class="col-auto col-form-label"
                                               style="padding-right:0;padding-left:10px;">操作人</label>
                                        <div class="col-auto">
                                            <input type="text" class="form-control" id="name" name="name" th:value="${pageobj.othersql3}"
                                                   placeholder="请输入操作人"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="row">
                                        <label class="col-auto col-form-label" style="padding-right:0;padding-left:10px;">开始时间</label>
                                        <div class="col-auto">
                                            <input type="date" class="form-control" id="start" name="start" th:value="${pageobj.othersql}"
                                                   placeholder="请输入开始时间"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                <div class="row">
                                    <label class="col-auto col-form-label" style="padding-right:0;padding-left:10px;">结束时间</label>
                                    <div class="col-auto">
                                        <input type="date" class="form-control" id="end" name="end" th:value="${pageobj.othersql1}"
                                               placeholder="请输入结束时间"/>
                                    </div>
                                </div>
                            </div>

                                <!--button-->
                                <div class="col-auto">
                                    <button type="submit" class="btn btn-primary me-1">搜索</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div id="wrapp" >
                        <div class="jsgrid table-responsive" data-parent="#accordion">
                            <input type="file" id="file" name="file" style="display: none" onchange="daoru(this)"/>
                            <table class="table table-striped table-bordered dt-responsive nowrap" style="width:100%;" id="logexm" >
                                <thead>
                                <tr>
                                    <th style="max-width:40px;">序号</th>
                                    <th>操作人名称</th>
                                    <th>操作日期</th>
                                    <th>操作内容</th>
                                </tr>
                                </thead>
                                <tbody id="tablebody">
                                    <tr th:each="item,stat:${pageobj.resultList}">
                                        <td th:text="${(pageobj.currentPage-1)*pageobj.pageSize+stat.index+1}"></td>
                                        <td th:text="${item.log002}"></td>
                                        <td th:text="${#dates.format(item.log003,'yyyy-MM-dd HH:mm:ss')}"></td>
                                        <td th:text="${item.log004}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <ul class="pagination">
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/popper.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>

<script type="text/javascript" src="js/main.min.js"></script>
<script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
<!--tags插件-->
<script type="text/javascript" src="js/jquery-tagsinput/jquery.tagsinput.min.js"></script>
<!--上传插件-->
<script type="text/javascript" src="js/webuploader/webuploader.js"></script>
<!--灯箱效果插件-->
<script type="text/javascript" src="js/magnific-popup/magnific-popup.min.js"></script>
<!--通知消息插件-->
<script type="text/javascript" src="js/bootstrap-notify.min.js"></script>
<!--引入标签插件js-->
<script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
<!--引入下拉插件js-->
<script type="text/javascript" src="js/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="js/bootstrap-select/i18n/defaults-zh_CN.min.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="js/layui/layui.js"></script>
<!-- 表格JS -->
<script type="text/javascript" src="static/tables/datatables.min.js"></script>
<script type="text/javascript" src="static/tables/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="static/tables/jszip.min.js"></script>
<script type="text/javascript" src="static/tables/pdfmake.min.js"></script>
<script type="text/javascript" src="static/tables/vfs_fonts.js"></script>
<script type="text/javascript" src="static/tables/buttons.html5.min.js"></script>
<script type="text/javascript" src="static/tables/buttons.print.min.js"></script>
<script type="text/javascript" src="static/tables/datatable.js"></script>
<!-- 翻页-->
<script type="text/javascript" src="pagejs/htfy.js"></script>
<!-- validate JS 验证-->
<script type="text/javascript" src="assets/jquery-validate/jquery.validate.js"></script>
<script type="text/javascript" src="assets/jquery-validate/validate-methods.js"></script>

<script type="text/javascript">

    var file_lastName="";
    var filesize;
    var layer = layui.layer;
    var load_index;

    function gobackpage(){
        window.history.back();
    }

    $(document).ready(function () {
        pdyes($("#pages").val(), $("#counts").val());
        $('#start').on('change', function () {
            var startTime =$("#start").val();
            if(startTime==""&&startTime==undefined) return;
            var endTime =$("#end").val();
            if(endTime==""&&endTime==undefined) return;
            var start=new Date(startTime.replace("-", "/").replace("-", "/"));
            var end=new Date(endTime.replace("-", "/").replace("-", "/"));
            if(end<start){
                $("#start").val("");
                return;
            } return;
        })
        $('#end').on('change', function () {
            var startTime =$("#start").val();
            if(startTime==""&&startTime==undefined) return;
            var endTime =$("#end").val();
            if(endTime==""&&endTime==undefined) return;
            var start=new Date(startTime.replace("-", "/").replace("-", "/"));
            var end=new Date(endTime.replace("-", "/").replace("-", "/"));
            if(end<start){
                $("#start").val("");
                return;
            } return;
        })
    })
    //翻页
    function fanye(pageindex) {
        var isnum=/^\d+$/.test(pageindex);
        if(isnum)
            usefanye(pageindex);
        else{
            alert("格式错误");
        }
    }

    //翻页
    function usefanye(pageindex){
        var params = [
            ["pages",pageindex],
            ["name",$.trim($("#name").val())],
            ["start",$.trim($("#start").val())],
            ["end",$.trim($("#end").val())]];
        form_submit("toHt/log","get",params,"_self");
    }

    function del(id){
        if (confirm("您确定删除吗?")) {
            load_index = layer.load(1);
            var formData = new FormData();
            formData.append("fid",id);
            formData.append("name",$("#name").val());
            formData.append("start",$("#start").val());
            formData.append("end",$("#end").val());
            $.ajax({
                url: 'toHt/dellog', // 服务器端处理上传文件的URL
                type: 'POST',
                data: formData,
                dataType:'json',
                contentType: false, // 不设置内容类型
                processData: false, // 不处理发送的数据
                success: function (res) {
                    var d = eval(res);
                    if(d.msg=="0"){
                        layer.msg("删除成功");
                        setTimeout(function(){
                            location.reload();
                        },1000);
                        layer.close(load_index);
                    }
                },
                error: function () { console.log('提交失败'); }
            });
        }
    }



    //最大日期限定
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + " " + date.getHours() + seperator2 + date.getMinutes()
            + seperator2 + date.getSeconds();
        return currentdate;
    }
</script>
</body>
</html>